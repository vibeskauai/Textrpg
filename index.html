<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ADVENTURE</title>
<style>
body { font-family: sans-serif; background:#111; color:#eee; margin:0; padding:0; }
h1 { font-size: 32px; text-align:center; color:#ffcc00; margin:10px; }
#stats { font-size: 34px; color:#00ffcc; margin:10px; }
#game { margin:10px; }
#log { white-space: pre-line; max-height: 400px; overflow-y: auto; border:1px solid #555; padding:10px; margin:10px; font-size: 34px; color:#eee; }
button { margin:8px; padding:20px 32px; font-size:30px; min-width:160px; border-radius:6px; background:#333; color:#eee; border:1px solid #666; cursor:pointer; }
button:hover { background:#444; }
button:disabled { opacity:0.5; cursor:default; }
</style>
</head>
<body>
<h1>ADVENTURE</h1>
<div id="stats"></div>
<div id="game"></div>
<div id="log"></div>

<script>
document.addEventListener("DOMContentLoaded", function(){

/* ---------------- Player & Enemy ---------------- */
let player = {
  hp:30, maxHp:30, damage:5, xp:0, gold:10, level:1,
  blocked:false, spells:3, maxSpells:3, skillPoints:0,
  meleeSkills:[
    {name:"Quick Slash", threshold:8, dmgMult:0.8},
    {name:"Precise Stab", threshold:10, dmgMult:1},
    {name:"Heavy Strike", threshold:12, dmgMult:1.5}
  ],
  inventory:[{name:"Health Potion", type:"heal", value:20, count:2}]
};
let enemy = {};
let encounterCount = 0;
let adventureMultiplier = 1;

/* ---------------- Utility Functions ---------------- */
function updateStats(){
  document.getElementById('stats').innerHTML =
    `HP: ${player.hp}/${player.maxHp} | DMG: ${player.damage} | Gold: ${player.gold} | XP: ${player.xp} | Level: ${player.level} | Spells: ${player.spells}/${player.maxSpells} | Multiplier: x${adventureMultiplier}`;
}

function log(msg,color="#eee"){
  let logDiv = document.getElementById('log');
  logDiv.innerHTML += `<span style="color:${color}">${msg}</span>\n`;
  logDiv.scrollTop = logDiv.scrollHeight;
  speak(msg);
}

function speak(text){
  if('speechSynthesis' in window){
    let utter = new SpeechSynthesisUtterance(text);
    utter.rate=1; utter.pitch=1;
    window.speechSynthesis.speak(utter);
  }
}

function rollD20(){ return Math.floor(Math.random()*20)+1; }

function delayedLog(lines,i,callback){
  if(i<lines.length){
    setTimeout(()=>{ log(lines[i]); delayedLog(lines,i+1,callback); },400);
  } else if(callback) callback();
}

/* ---------------- Enemies ---------------- */
const enemies = [
  {name:'Rat', hp:5, damage:2, xp:2, gold:2, actions:['scurries to bite','leaps and scratches','gnaws at your boot','nibbles viciously','dodges and strikes']},
  {name:'Goblin', hp:8, damage:3, xp:4, gold:3, actions:['slashes with a dagger','throws a rock','lunges wildly','stabs with crooked blade','swings a club']},
  {name:'Slime', hp:6, damage:2, xp:3, gold:3, actions:['slaps with goo','hurls slime','oozes forward','splashes acidic goo','splits and strikes']},
  {name:'Bandit', hp:10, damage:4, xp:6, gold:5, actions:['swings rusty sword','throws a punch','slashes dagger','lunges at you','sneaks behind for strike']},
  {name:'Skeleton', hp:9, damage:3, xp:5, gold:4, actions:['slashes bone sword','hurls rib','lunges hollow-eyed','clatters forward','stabs with femur']},
  {name:'Orc', hp:12, damage:5, xp:8, gold:7, actions:['smashes club','charges','swings fists','roars and strikes','stomps heavily']},
  {name:'Giant Spider', hp:14, damage:4, xp:10, gold:8, actions:['lunges and bites','shoots web','slashes legs','spins to strike','venomous bite']},
  {name:'Troll', hp:20, damage:7, xp:15, gold:15, actions:['swings fists','stomps ground','swipes claws','smashes rock','crushes with brute force']},
  {name:'Dark Knight', hp:18, damage:6, xp:12, gold:12, actions:['strikes cursed sword','shield bash','slashes deadly','charges forward','lunges with blade']},
  {name:'Dragon', hp:30, damage:10, xp:25, gold:25, actions:['breathes fire','swipes claws','lashes tail','roars and strikes','swoops down']},
  {name:'Dragon Lord', hp:50, damage:15, xp:50, gold:50, actions:['breathes inferno','slashes with claws','smashes with tail','dark magic blast','stomps fiercely']}
];

/* ---------------- UI ---------------- */
function resetGameButtons(inBattle=false){
  let btnHTML = '';
  if(!inBattle) btnHTML+=`<button onclick="adventure()">Adventure</button>`;
  btnHTML+=`<button onclick="meleeMenu()">Attack</button>
            <button onclick="block()">Block</button>
            <button onclick="spellMenu()">Spells</button>
            <button onclick="inventoryMenu()">Inventory</button>
            <button onclick="runAway()">Run</button>`;
  document.getElementById('game').innerHTML = btnHTML;
}

/* ---------------- Adventure ---------------- */
function adventure(){
  encounterCount++;
  let pool = enemies.filter(e=>{
    if(player.level<=2) return ['Rat','Goblin','Slime'].includes(e.name);
    if(player.level<=4) return ['Goblin','Skeleton','Bandit'].includes(e.name);
    if(player.level<=6) return ['Orc','Giant Spider','Skeleton','Bandit'].includes(e.name);
    return enemies;
  });
  enemy = {...pool[Math.floor(Math.random()*pool.length)]};
  log(`⚔️ A ${enemy.name} appears!`, "#ff5555");
  resetGameButtons(true);
  updateStats();
}

/* ---------------- Melee ---------------- */
function meleeMenu(){
  let btnHTML = '';
  player.meleeSkills.forEach((m,i)=>{ btnHTML+=`<button onclick="meleeAttack(${i})">${m.name}</button>`; });
  btnHTML+=`<button onclick="resetGameButtons(true)">Back</button>`;
  document.getElementById('game').innerHTML = btnHTML;
}

function meleeAttack(index){
  if(!enemy.name) return;
  let move = player.meleeSkills[index];
  let roll = rollD20();
  let lines = [`You use ${move.name}.`,`Roll: ${roll}`];
  if(roll===20){
    let critDmg = Math.floor(player.damage*move.dmgMult*2*adventureMultiplier);
    enemy.hp -= critDmg;
    lines.push(`✨ Critical hit! ${enemy.name} takes ${critDmg} damage!`);
  } else if(roll>=move.threshold){
    let dmg = Math.floor(player.damage*move.dmgMult*adventureMultiplier);
    enemy.hp -= dmg;
    lines.push(`${enemy.name} takes ${dmg} damage!`);
  } else lines.push(`Your attack misses!`);
  delayedLog(lines,0,checkEnemyStatus);
  updateStats();
}

/* ---------------- Block ---------------- */
function block(){ player.blocked=true; delayedLog(["You raise your guard."],0,enemyAttack); }

/* ---------------- Spells ---------------- */
function spellMenu(){
  if(player.spells<=0){ log("No spells left!"); return; }
  document.getElementById('game').innerHTML=`
    <button onclick="castSpell('fireball')">Fireball</button>
    <button onclick="castSpell('ice')">Ice Shard</button>
    <button onclick="castSpell('lightning')">Lightning Bolt</button>
    <button onclick="resetGameButtons(true)">Back</button>`;
}

function castSpell(type){
  if(!enemy.name) return;
  if(player.spells<=0){ log("No spells!"); return; }
  player.spells--;
  let roll=rollD20();
  let dmg=0, desc="";
  if(type==='fireball'){ dmg=8; desc="You hurl a blazing fireball."; }
  if(type==='ice'){ dmg=6; desc="You launch a freezing ice shard."; }
  if(type==='lightning'){ dmg=10; desc="You call down a lightning bolt."; }
  let lines=[desc,`Roll: ${roll}`];
  if(roll>=10){ enemy.hp-=dmg; lines.push(`${enemy.name} takes ${dmg} damage!`);}
  else lines.push("The spell fizzles!");
  delayedLog(lines,0,checkEnemyStatus);
  updateStats();
}

/* ---------------- Inventory ---------------- */
function inventoryMenu(){
  let btnHTML = '';
  player.inventory.forEach((item,i)=>{ btnHTML+=`<button onclick="useItem(${i})">${item.name} x${item.count}</button>`; });
  btnHTML+=`<button onclick="resetGameButtons(true)">Back</button>`;
  document.getElementById('game').innerHTML = btnHTML;
}

function useItem(index){
  let item = player.inventory[index];
  if(item.count<=0){ log("No more of this item!"); return; }
  if(item.type==="heal"){ player.hp+=item.value; if(player.hp>player.maxHp) player.hp=player.maxHp; log(`You use ${item.name} and heal ${item.value} HP!`);}
  item.count--;
  updateStats();
  enemyAttack();
}

/* ---------------- Run ---------------- */
function runAway(){
  if(!enemy.name){ log("No enemy to run from."); return; }
  log("You flee from battle!");
  enemy={};
  resetGameButtons(false);
}

/* ---------------- Enemy Attack ---------------- */
function enemyAttack(){
  if(!enemy.name) return;
  const roll=rollD20();
  let dmg=enemy.damage; if(player.blocked){ dmg=Math.floor(dmg/2); player.blocked=false; }
  const action = enemy.actions[Math.floor(Math.random()*enemy.actions.length)];
  let lines=[`${enemy.name} ${action}.`,`Roll: ${roll}`];
  if(roll===20){ let critDmg=dmg*2; player.hp-=critDmg; lines.push(`💥 Critical hit! You take ${critDmg} damage!`);}
  else if(roll>=10){ player.hp-=dmg; lines.push(`It hits you for ${dmg} damage.`);}
  else lines.push('It misses you!');
  delayedLog(lines,0,()=>{ if(player.hp<=0) gameOver(); updateStats(); });
}

/* ---------------- Check Enemy Status ---------------- */
function checkEnemyStatus(){
  if(enemy.hp<=0){
    let lines=[`You defeated the ${enemy.name}!`,`You gain ${enemy.xp} XP and ${enemy.gold} gold.`];
    player.xp+=enemy.xp; player.gold+=enemy.gold; enemy={};
    delayedLog(lines,0,()=>{
      checkLevelUp();
      checkCamp();
      updateStats();
      resetGameButtons(false);
    });
  } else enemyAttack();
}

/* ---------------- Level Up ---------------- */
function checkLevelUp(){
  let need = player.level*20; // increased XP needed
  if(player.xp>=need){
    player.level++;
    player.maxHp+=5; player.hp=player.maxHp;
    player.damage+=2;
    player.skillPoints++;
    log(`*** You reached Level ${player.level}! You have ${player.skillPoints} skill points to allocate. ***`, "#00ff00");
  }
}

/* ---------------- Camp ---------------- */
function checkCamp(){
  if(encounterCount>=3+Math.floor(Math.random()*3)){
    encounterCount=0;
    showCampOptions();
  }
}

function showCampOptions(){
  player.spells=player.maxSpells;
  log('You rest at the camp. Spell charges restored.', "#00ffcc");
  updateStats();
  log('--- CAMP ---','#ffcc00');
  log('Purchase: 1) Weapon (+2 DMG, 20 Gold), 2) Armor (+5 Max HP, 20 Gold), 3) Spell (+1 Max Spell, 10 Gold).','#ffcc00');
  let gameDiv = document.getElementById('game');
  gameDiv.innerHTML=`
    <button onclick="buy('weapon')">Buy Weapon</button>
    <button onclick="buy('armor')">Buy Armor</button>
    <button onclick="buy('spell')">Buy Spell</button>
    <button onclick="leaveCamp()">Leave Camp</button>
  `;
}

function buy(item){
  if(item==='weapon' && player.gold>=20){ player.gold-=20; player.damage+=2; log("Weapon upgraded!"); }
  else if(item==='armor' && player.gold>=20){ player.gold-=20; player.maxHp+=5; player.hp=player.maxHp; log("Armor upgraded!"); }
  else if(item==='spell' && player.gold>=10){ player.gold-=10; player.maxSpells+=1; player.spells=player.maxSpells; log("Spell capacity increased!"); }
  else { log("Not enough gold!"); }
  updateStats();
}

function leaveCamp(){ log("You leave camp and continue your journey."); resetGameButtons(false); }

/* ---------------- Game Over ---------------- */
function gameOver(){ log("*** You died! Game Over. ***","#ff0000"); document.getElementById('game').innerHTML=''; }

/* ---------------- Initialize ---------------- */
updateStats();
resetGameButtons(false);

});
</script>
</body>
</html>